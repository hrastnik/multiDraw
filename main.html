<html> 
    <head> 
        <script src="https://cdn.socket.io/socket.io-1.3.5.js"></script>
        <script>
        
        socket = io();
        
        function startEmittingMovement(e) {
            ctx.lineTo((e.pageX - cvs.offsetLeft),(e.pageY - cvs.offsetTop));
            ctx.stroke();
            socket.emit('m', line_id+","+(e.pageX - cvs.offsetLeft)+","+(e.pageY - cvs.offsetTop));
        }
        
        drawObject = {};
        
        function onLoadCallback () {
            cvs = document.getElementById('cvs');
            ctx = cvs.getContext("2d");
            line_id  = "";
            mouseDown = false;
            
            socket.on('m', function(msg) {
                var splitCoords = msg.split(',');
                var id = splitCoords[0];
                var x = parseInt(splitCoords[1]);
                var y = parseInt(splitCoords[2]);
                if (typeof (drawObject[id]) == 'undefined') drawObject[id] = new Array();
                drawObject[id].push([x, y]);
            });
            
            socket.on('s', function(line_id) {
                while (mouseDown) continue; // wait for user to release mouse
                ctx.beginPath();
                ctx.moveTo(drawObject[line_id][0][0], drawObject[line_id][0][1]);
                for (var i = 1;i < drawObject[line_id].length;i++) {
                    ctx.lineTo(drawObject[line_id][i][0], drawObject[line_id][i][1]);
                }
                ctx.stroke();
                delete drawObject[line_id];
            });
            
            cvs.addEventListener("mousedown", function(e) {
                line_id = Math.random().toString(36).substr(2,5); // generate new line id
                mouseDown = true;
                ctx.beginPath();
                ctx.moveTo((e.pageX - cvs.offsetLeft),(e.pageY - cvs.offsetTop));
                cvs.addEventListener("mousemove", startEmittingMovement);
            });
            cvs.addEventListener("mouseup", function(e) {
                mouseDown = false;
                cvs.removeEventListener("mousemove", startEmittingMovement);
                socket.emit('s', line_id); // stop line
            });
        }
        </script>
    </head> 
    <body onload="onLoadCallback()"> 
    <canvas id="cvs" height="600" width="800" style="background:red;"> </canvas>
    </body> 
</html>